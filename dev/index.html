<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Apply Mapping Functions in Parallel using Futures • furrr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Apply Mapping Functions in Parallel using Futures">
<meta name="description" content="Implementations of the family of map() functions from purrr that can be resolved using any future-supported backend, e.g. parallel on the local machine or distributed on a compute cluster.">
<meta property="og:description" content="Implementations of the family of map() functions from purrr that can be resolved using any future-supported backend, e.g. parallel on the local machine or distributed on a compute cluster.">
<meta property="og:image" content="https://furrr.futureverse.org/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">furrr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/carrier.html">Alternative to automatic globals detection</a></li>
    <li><a class="dropdown-item" href="articles/chunking.html">Chunking input</a></li>
    <li><a class="dropdown-item" href="articles/gotchas.html">Common gotchas</a></li>
    <li><a class="dropdown-item" href="articles/progress.html">Progress notifications with progressr</a></li>
    <li><a class="dropdown-item" href="articles/remote-connections.html">Remote connections</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/futureverse/furrr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="furrr-">furrr 
<a class="anchor" aria-label="anchor" href="#furrr-"></a>
</h1>
</div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The goal of furrr is to combine purrr’s family of mapping functions with future’s parallel processing capabilities. The result is near drop in replacements for purrr functions such as <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl()</a></code>, which can be replaced with their furrr equivalents of <code><a href="reference/future_map.html">future_map()</a></code> and <code><a href="reference/future_map2.html">future_map2_dbl()</a></code> to map in parallel.</p>
<p>The code draws heavily from the implementations of purrr and future.apply and this package would not be possible without either of them.</p>
</div>
<div class="section level2">
<h2 id="what-has-been-implemented">What has been implemented?<a class="anchor" aria-label="anchor" href="#what-has-been-implemented"></a>
</h2>
<p>Every variant of the following functions has been implemented:</p>
<ul>
<li><code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code></li>
<li><code><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2()</a></code></li>
<li><code><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap()</a></code></li>
<li><code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk()</a></code></li>
<li><code><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap()</a></code></li>
<li><code><a href="https://purrr.tidyverse.org/reference/modify.html" class="external-link">modify()</a></code></li>
</ul>
<p>This includes atomic variants like <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl()</a></code> through <code><a href="reference/future_map.html">future_map_dbl()</a></code> and predicate variants like <code><a href="https://purrr.tidyverse.org/reference/map_if.html" class="external-link">map_at()</a></code> through <code><a href="reference/future_map_if.html">future_map_at()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of furrr from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"furrr"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"futureverse/furrr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="learning">Learning<a class="anchor" aria-label="anchor" href="#learning"></a>
</h2>
<p>The easiest way to learn about furrr is to browse <a href="https://furrr.futureverse.org/">the website</a>. In particular, the <a href="https://furrr.futureverse.org/reference/index.html">function reference</a> page can be useful to get a general overview of the functions in the package, and the following vignettes are deep dives into various parts of furrr:</p>
<ul>
<li><p><a href="https://furrr.futureverse.org/articles/articles/gotchas.html">Common gotchas</a></p></li>
<li><p><a href="https://furrr.futureverse.org/articles/articles/chunking.html">Learn how furrr “chunks” your input</a></p></li>
<li><p><a href="https://furrr.futureverse.org/articles/articles/carrier.html">carrier - An alternative to automatic globals detection</a></p></li>
<li><p><a href="https://furrr.futureverse.org/articles/articles/progress.html">Progress notifications with progressr</a></p></li>
<li><p><a href="https://furrr.futureverse.org/articles/articles/remote-connections.html">Using furrr with connections</a></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>furrr has been designed to function as identically to purrr as possible, so that you can immediately have familiarity with it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/futureverse/furrr" class="external-link">furrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hello"</span>, <span class="st">"world"</span><span class="op">)</span>, <span class="op">~</span><span class="va">.x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "hello"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "world"</span></span>
<span></span>
<span><span class="fu"><a href="reference/future_map.html">future_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hello"</span>, <span class="st">"world"</span><span class="op">)</span>, <span class="op">~</span><span class="va">.x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "hello"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "world"</span></span></code></pre></div>
<p>The default backend for future (and through it, furrr) is a sequential one. This means that the above code will run out of the box, but it will <em>not</em> be in parallel. The design of future makes it incredibly easy to change this so that your code will run in parallel.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set a "plan" for how the code should run.</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This does run in parallel!</span></span>
<span><span class="fu"><a href="reference/future_map.html">future_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hello"</span>, <span class="st">"world"</span><span class="op">)</span>, <span class="op">~</span><span class="va">.x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "hello"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "world"</span></span></code></pre></div>
<p>If you are still skeptical, here is some proof that we are running in parallel.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jabiru/tictoc" class="external-link">tictoc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This should take 6 seconds in total running sequentially</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tic</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nothingness</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/future_map.html">future_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6.08 sec elapsed</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This should take ~2 seconds running in parallel, with a little overhead</span></span>
<span><span class="co"># in `future_map()` from sending data to the workers. There is generally also</span></span>
<span><span class="co"># a one time cost from `plan(multisession)` setting up the workers.</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tic</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nothingness</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/future_map.html">future_map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2.212 sec elapsed</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-transfer">Data transfer<a class="anchor" aria-label="anchor" href="#data-transfer"></a>
</h2>
<p>It’s important to remember that data has to be passed back and forth between the workers. This means that whatever performance gain you might have gotten from your parallelization can be crushed by moving large amounts of data around. For example, if you are moving large data frames to the workers, running models in parallel, and returning large model objects back, the shuffling of data can take a large chunk of that time. Rather than returning the entire model object, you might consider only returning a performance metric, or smaller specific pieces of that model that you are most interested in.</p>
<p>This performance drop can especially be prominent if using <code><a href="reference/future_map2.html">future_pmap()</a></code> to iterate over rows and return large objects at each iteration.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=furrr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/futureverse/furrr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/futureverse/furrr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing furrr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Davis Vaughan <br><small class="roles"> Author, maintainer </small>  </li>
<li>Matt Dancho <br><small class="roles"> Author </small>  </li>
<li>RStudio <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=furrr" class="external-link"><img src="https://www.r-pkg.org/badges/version/furrr" alt="CRAN status"></a></li>
<li><a href="https://github.com/futureverse/furrr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/futureverse/furrr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/futureverse/furrr" class="external-link"><img src="https://codecov.io/gh/futureverse/furrr/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Vaughan, Matt Dancho, RStudio.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
